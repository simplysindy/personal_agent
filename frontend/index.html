<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Obsidian AI Personal Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#8162a0",
                        "background-light": "#f7f6f7",
                        "background-dark": "#19161c",
                        "surface-dark": "#1a1122",
                        "glow-purple": "#b26ef7"
                    },
                    fontFamily: {
                        display: ["Noto Serif", "serif"],
                        sans: ["Space Grotesk", "sans-serif"]
                    },
                    boxShadow: {
                        neon: "0 0 10px rgba(127, 19, 236, 0.5), 0 0 20px rgba(127, 19, 236, 0.3)",
                        "neon-sm": "0 0 5px rgba(127, 19, 236, 0.5)",
                    }
                }
            }
        };
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-stardust {
                background-color: #0f0a15;
                background-image:
                    radial-gradient(1px 1px at 10% 10%, rgba(255,255,255,0.15) 1px, transparent 0),
                    radial-gradient(1px 1px at 20% 20%, rgba(255,255,255,0.1) 1px, transparent 0),
                    radial-gradient(2px 2px at 30% 30%, rgba(255,255,255,0.15) 1px, transparent 0),
                    radial-gradient(1px 1px at 40% 40%, rgba(255,255,255,0.1) 1px, transparent 0),
                    radial-gradient(2px 2px at 50% 50%, rgba(255,255,255,0.15) 1px, transparent 0),
                    radial-gradient(1px 1px at 60% 60%, rgba(255,255,255,0.1) 1px, transparent 0),
                    radial-gradient(2px 2px at 70% 70%, rgba(255,255,255,0.15) 1px, transparent 0),
                    radial-gradient(1px 1px at 80% 80%, rgba(255,255,255,0.1) 1px, transparent 0),
                    radial-gradient(2px 2px at 90% 90%, rgba(255,255,255,0.15) 1px, transparent 0);
                background-size: 550px 550px;
            }
            .glass-panel {
                background: rgba(26, 17, 34, 0.7);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border: 1px solid rgba(127, 19, 236, 0.1);
            }
            ::-webkit-scrollbar {
                width: 6px;
            }
            ::-webkit-scrollbar-track {
                background: #1a1122;
            }
            ::-webkit-scrollbar-thumb {
                background: #4d3267;
                border-radius: 3px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #7f13ec;
            }
            .typing-indicator span {
                animation: blink 1.4s infinite both;
            }
            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }
            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes blink {
                0%, 80%, 100% { opacity: 0.3; }
                40% { opacity: 1; }
            }
            .message-enter {
                animation: messageSlideIn 0.3s ease-out forwards;
            }
            @keyframes messageSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }
    </style>
</head>
<body class="font-sans bg-background-light dark:bg-background-dark text-slate-900 dark:text-white overflow-hidden h-screen flex">
    <!-- Left Sidebar - Navigation -->
    <nav class="w-20 md:w-64 h-full border-r border-white/5 bg-[#120c18] flex flex-col justify-between shrink-0 z-20 shadow-2xl transition-all duration-300">
        <div class="flex flex-col gap-6 p-4 h-full overflow-hidden">
            <!-- Logo -->
            <div class="flex items-center gap-3 pl-1">
                <div class="relative flex items-center justify-center size-10 rounded-full bg-gradient-to-br from-primary to-purple-900 shadow-neon-sm">
                    <span class="material-symbols-outlined text-white text-[24px]">token</span>
                </div>
                <div class="hidden md:flex flex-col">
                    <h1 class="text-white text-lg font-bold tracking-widest">OBSIDIAN AI</h1>
                    <span class="text-xs text-glow-purple/70 font-mono tracking-wider">VAULT AGENT</span>
                </div>
            </div>

            <div class="h-px w-full bg-gradient-to-r from-transparent via-purple-500/20 to-transparent"></div>

            <!-- Conversation History -->
            <div class="flex flex-col gap-1 overflow-y-auto flex-1">
                <h3 class="hidden md:block text-[10px] text-gray-500 font-bold uppercase tracking-[0.2em] mb-3 px-2">Conversation History</h3>
                <div id="conversation-list">
                    <!-- Conversations loaded dynamically -->
                </div>
                <button id="new-chat-btn" class="group flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white mt-2 border border-dashed border-white/10">
                    <span class="material-symbols-outlined group-hover:text-glow-purple transition-colors">add</span>
                    <span class="hidden md:block font-medium text-sm tracking-wide">New Chat</span>
                </button>
                <button id="clear-history-btn" class="group flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-red-500/10 transition-all text-gray-500 hover:text-red-400 mt-1 border border-transparent hover:border-red-500/20">
                    <span class="material-symbols-outlined group-hover:text-red-400 transition-colors">delete_sweep</span>
                    <span class="hidden md:block font-medium text-sm tracking-wide">Clear History</span>
                </button>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="flex flex-col gap-2 p-4">
            <div class="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent mb-2"></div>
            <a id="settings-btn" class="group flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white cursor-pointer">
                <span class="material-symbols-outlined group-hover:text-glow-purple transition-colors">settings</span>
                <span class="hidden md:block font-medium text-sm tracking-wide">Vault Settings</span>
            </a>
            <div class="flex items-center gap-3 px-3 py-2 mt-2 rounded-xl bg-white/5 border border-white/5">
                <div class="size-8 rounded-full bg-gradient-to-tr from-purple-400 to-blue-500 flex items-center justify-center shrink-0">
                    <span class="material-symbols-outlined text-white text-sm">person</span>
                </div>
                <div class="hidden md:flex flex-col">
                    <span class="text-white text-xs font-bold">Commander</span>
                    <span id="sync-status" class="text-[10px] text-green-400">Sync Active</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col relative bg-stardust overflow-hidden">
        <!-- Header -->
        <header class="flex items-center justify-between px-8 py-4 z-10 glass-panel border-b-0 border-t-0 border-x-0 bg-opacity-30">
            <div class="flex flex-col">
                <h2 class="text-2xl font-bold text-white tracking-tight flex items-center gap-2">
                    <span id="connection-indicator" class="w-2 h-2 rounded-full bg-yellow-500 shadow-[0_0_10px_#eab308]"></span>
                    <span id="session-title">SESSION: NEW CHAT</span>
                </h2>
                <p class="text-xs text-primary font-mono mt-1 uppercase tracking-widest">Vault Integration: <span id="vault-status">Connecting...</span></p>
            </div>
            <div class="flex items-center gap-6">
                <div class="hidden lg:flex items-center gap-4 text-xs font-mono text-gray-400 bg-black/40 px-4 py-2 rounded-full border border-white/5">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-[16px]">database</span>
                        <span>NOTES: <span id="notes-count">--</span></span>
                    </div>
                    <div class="w-px h-3 bg-white/20"></div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-[16px]">schema</span>
                        <span>GRAPH NODES: <span id="graph-nodes-count">--</span></span>
                    </div>
                </div>
                <button id="sync-btn" class="relative group p-2 rounded-full hover:bg-white/10 transition-colors" title="Sync Vault">
                    <span class="material-symbols-outlined text-gray-300">sync</span>
                </button>
            </div>
        </header>

        <!-- Chat Area -->
        <div class="flex-1 overflow-y-auto relative z-0 flex flex-col px-4 md:px-0" id="chat-container">
            <!-- Vault Status Orb -->
            <div class="w-full flex justify-center py-6 pointer-events-none z-0">
                <div class="relative flex flex-col items-center">
                    <div id="orb-container" class="w-24 h-24 rounded-full bg-gradient-to-b from-[#b26ef7] to-[#5b21b6] flex items-center justify-center relative shadow-[0_0_30px_rgba(127,19,236,0.5)]">
                        <div class="absolute inset-0 rounded-full bg-primary blur-xl opacity-40"></div>
                        <div class="w-[90%] h-[90%] rounded-full bg-black/80 flex items-center justify-center overflow-hidden">
                            <div class="w-full h-full bg-[url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=200&auto=format&fit=crop')] bg-cover opacity-60 mix-blend-screen"></div>
                        </div>
                    </div>
                    <p id="orb-status" class="mt-4 text-glow-purple text-sm font-mono tracking-[0.2em]">CONNECTING...</p>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="w-full max-w-4xl mx-auto flex flex-col relative pb-48 pt-4 px-6 md:px-12" id="messages-container">
                <!-- Timeline line -->
                <div class="absolute left-[44px] md:left-[68px] top-0 bottom-0 w-0.5 bg-gradient-to-b from-transparent via-purple-900/50 to-transparent"></div>

                <!-- Messages will be inserted here -->
            </div>
        </div>

        <!-- Input Area -->
        <div class="absolute bottom-0 left-0 right-0 h-40 bg-gradient-to-t from-[#0f0a15] via-[#0f0a15] to-transparent z-10 pointer-events-none"></div>
        <div class="absolute bottom-6 left-0 right-0 px-4 md:px-0 flex justify-center z-20">
            <div class="w-full max-w-3xl glass-panel rounded-2xl p-2 shadow-2xl flex flex-col relative transition-all duration-300 focus-within:shadow-neon focus-within:border-primary/50">
                <form id="chat-form" class="flex items-center gap-2 p-1">
                    <div class="bg-gradient-to-br from-gray-800 to-black rounded-xl p-2 shrink-0">
                        <span class="material-symbols-outlined text-gray-400">edit_square</span>
                    </div>
                    <input
                        id="message-input"
                        autocomplete="off"
                        class="w-full bg-transparent border-none text-white placeholder-gray-500 focus:ring-0 text-base md:text-lg h-10 outline-none"
                        placeholder="Type a message or command..."
                        type="text"
                    />
                    <div class="flex items-center gap-1 pr-1">
                        <button type="button" id="graph-btn" class="p-2 text-gray-400 hover:text-white transition-colors rounded-lg hover:bg-white/5" title="View Graph">
                            <span class="material-symbols-outlined text-[20px]">hub</span>
                        </button>
                        <button type="submit" id="send-btn" class="h-10 px-4 bg-primary hover:bg-purple-600 text-white rounded-lg flex items-center justify-center transition-all shadow-[0_0_10px_rgba(127,19,236,0.3)] hover:shadow-[0_0_15px_rgba(127,19,236,0.6)] disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-[20px]">arrow_upward</span>
                        </button>
                    </div>
                </form>
                <div class="px-3 pb-1 pt-1 flex gap-4 text-[10px] text-gray-500 font-mono uppercase tracking-wider overflow-x-auto">
                    <button class="quick-action flex items-center gap-1 hover:text-primary cursor-pointer transition-colors whitespace-nowrap" data-action="Summarize my vault">
                        <span class="w-1 h-1 bg-gray-600 rounded-full"></span> Summarize Vault
                    </button>
                    <button class="quick-action flex items-center gap-1 hover:text-primary cursor-pointer transition-colors whitespace-nowrap" data-action="Find connections between my recent notes">
                        <span class="w-1 h-1 bg-gray-600 rounded-full"></span> Find Connections
                    </button>
                    <button class="quick-action flex items-center gap-1 hover:text-primary cursor-pointer transition-colors whitespace-nowrap" data-action="What projects am I working on?">
                        <span class="w-1 h-1 bg-gray-600 rounded-full"></span> List Projects
                    </button>
                    <button class="quick-action flex items-center gap-1 hover:text-primary cursor-pointer transition-colors whitespace-nowrap" data-action="Show orphaned notes">
                        <span class="w-1 h-1 bg-gray-600 rounded-full"></span> Find Orphans
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Right Sidebar - Intelligence Panel -->
    <aside class="hidden xl:flex w-80 h-full border-l border-white/5 bg-[#0f0a15] flex-col p-6 gap-6 shrink-0 relative z-10">
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-white text-sm font-bold uppercase tracking-wider">Vault Intelligence</h3>
            <button id="refresh-intel-btn" class="material-symbols-outlined text-gray-500 cursor-pointer hover:text-white text-[18px]">refresh</button>
        </div>

        <!-- Indexing Progress -->
        <div class="p-4 rounded-xl bg-[#15101a] border border-white/5">
            <div class="flex justify-between items-end mb-2">
                <span class="text-xs text-gray-400">Vault Indexing</span>
                <span id="index-percent" class="text-lg text-white font-mono">--%</span>
            </div>
            <div class="w-full h-1.5 bg-gray-800 rounded-full overflow-hidden">
                <div id="index-bar" class="h-full bg-gradient-to-r from-primary to-blue-500 w-0 rounded-full shadow-[0_0_8px_rgba(127,19,236,0.5)] transition-all duration-500"></div>
            </div>
            <div class="mt-2 text-[10px] text-gray-500 flex justify-between">
                <span>Documents: <span id="doc-count">--</span></span>
                <span id="index-status">Checking...</span>
            </div>
        </div>

        <!-- Related Notes / Search Results -->
        <div class="flex-1 overflow-hidden flex flex-col">
            <h3 class="text-white text-xs font-bold uppercase tracking-wider mb-3 text-gray-500">Related Notes</h3>
            <div id="related-notes" class="flex flex-col gap-2 overflow-y-auto flex-1">
                <!-- Related notes loaded dynamically -->
                <div class="text-gray-500 text-xs italic p-2">Send a message to see related notes...</div>
            </div>
        </div>

        <!-- Graph Preview -->
        <div id="graph-preview" class="relative rounded-lg border border-white/5 overflow-hidden group cursor-pointer" title="Click to open graph view">
            <div class="h-32 bg-gradient-to-br from-purple-900/20 to-black flex items-center justify-center">
                <div id="mini-graph" class="w-full h-full"></div>
            </div>
            <div class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity">
                <span class="text-[10px] font-mono text-glow-purple tracking-[0.3em] uppercase">Open Graph View</span>
            </div>
        </div>
    </aside>

    <!-- Graph Modal -->
    <div id="graph-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-8">
        <div class="w-full h-full max-w-6xl max-h-[80vh] glass-panel rounded-2xl flex flex-col overflow-hidden">
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <h2 class="text-xl font-bold text-white">Knowledge Graph</h2>
                <button id="close-graph-modal" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                    <span class="material-symbols-outlined text-gray-400">close</span>
                </button>
            </div>
            <div id="graph-container" class="flex-1 relative">
                <!-- Graph will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-8">
        <div class="w-full max-w-lg glass-panel rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-white">Vault Settings</h2>
                <button id="close-settings-modal" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                    <span class="material-symbols-outlined text-gray-400">close</span>
                </button>
            </div>
            <div class="space-y-4">
                <div class="p-4 rounded-lg bg-white/5 border border-white/10">
                    <h3 class="text-sm font-bold text-white mb-2">Vault Sync</h3>
                    <p class="text-xs text-gray-400 mb-3">Re-index all documents in your vault</p>
                    <button id="full-sync-btn" class="px-4 py-2 bg-primary hover:bg-purple-600 text-white text-sm rounded-lg transition-colors">
                        Start Full Sync
                    </button>
                </div>
                <div class="p-4 rounded-lg bg-white/5 border border-white/10">
                    <h3 class="text-sm font-bold text-white mb-2">API Status</h3>
                    <div class="flex items-center gap-2">
                        <span id="api-status-indicator" class="w-2 h-2 rounded-full bg-yellow-500"></span>
                        <span id="api-status-text" class="text-xs text-gray-400">Checking...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
